# UPDI series resistor
All "modern" AVR's are programmed via UPDI. UPDI programming is most frequently achieved by loading the "jtag2updi" firmware onto an Arduino Nano or similar cheap, abundant board. These cost a fraction of what the official programmers cost - even accounting for the large discounts that Microchip frequently offers on them. More importantly, they work great with avrdude, the de facto standard software for uploading to AVR devices among hobbyists and Arduino users in general. When building your own UPDI programmer and/or board (as is widely documented), there must be a resistor in series with the UPDI line. There has been some level od confusion regarding the appropraite resistor for this application.* One of the most widely cited values is 4.7k - this is actually inappropriate. 

## Purpose and requirements
**The exact value of this resistor is far from critical**. This "series resistor" on the UPDI line has only one purpose: To protect the chip and the programmer from damage due to excessive current through an I/O pin in the event that the target and programmer somehow end up out of sync and try to drive that line in opposite directions. It also serves to prevent damage in the event that the programmer is running at a higher Vcc than the target (see note below). This is a very weak constraint -The **recommended**  maximum of 20 mA would give a lower limit of just under 270 ohms, assuming there was no voltage drop across the pin drivers (which of course isn't a valid assumption). 

Obviously it must also do this without interfering with programming. Like AVR reset pins, the UPDI pin always has the internal pullup. Per datasheet this has a minimum equivilent resistance of 20k ohms. The programmer must be ablke to drive this pin low for the target. With the threshold for a LOW of 0.3 x Vcc, a 4.7k resistor is dangerously close to this boundary condition (assuming worst case strong internal pullup) - 4.7/(20+4.7) = 0.2 x Vcc. This suggests that a lower value would be more appropriate, and farther from these limits.

## Target vs programmer
The next question is whether to put the resistor on the target or the programmer. Placing it on the target has the advantage of allowing a cheap programmer to be readily fabricated from abundant Nano clones. Being able to make a programmer with just dupont jumpers and and a nano means that one can be made without soldering, putting cheap UPDI programming within easy reach of electronics novices: it becomes as easy as Arduino as ISP. However, most official programmers have their own series resistor, typically in the range of hundreds of ohms to 2.2k. It is highly desirable for these to be capable of programming a board without issue. 

## Conclusion
Because the range of acceptable resistor values is so wide, we can easily choose a value which allows use with a programmer with or without it's own resistor. My current recommendation is that a **470 ohm** resistor be placed on the board for any UPDI chip, and a similar resistor used for the programmer. A total resistance of 940 Ohms is near the middle of the safe range on a logarithmic scale, 470 is safe, and even (just barely) the 5170 that would result from using with a target that had a 4.7k resistor on board would all be within the safe zone. 

## Notes

### Vcc differences
It is often cautioned that the operating voltage (Vcc) of the target must not be higher than that of the programmer (eg, from the jtag2updi readme "since the UPDI pin is high voltage tolerant, it's ok to have V_prog > V_target, but not the reverse. ". This caution, while well-founded, is in fact not a concern (at least, provided the programmer is a typical AVR microcontroller, and provided that the resistor value is high enough to keep the current through the I/O pin within  while the devices are fighting over controll of the line within the specs for both devices. The reason for this is that the maximum "current injection" permitted through an I/O pin on the modern AVR parts is truly monstrous by the standards of the microcontroller world; in fact it is the same as the maximum recommended I/O pin current: 20mA (compare to 1 mA on the classive AVR microcontrollers) - thus between the protection diodes and series resistor, any situation in which this became a problem would require one of the parts to be running well above it's supported opterating voltage range. The modern tinyAVR parts furthermore support HV UPDI programmming and can take 12v on the reset pin for that anyway. 

### megaTinyCore background + history
It is not credible for me to deny that I contributed to this confusion. I was initially confused myself as to the purpose and requirements for this resistor, and for over a year, promoted the use of a 4.7k resistor. This is inappropriately high, as described above. Customers complained about this when I was selling boards with this value of resistor, leading to the change in my recommendations amd assebled boards in Q2 2020.

This whole discussion begs the question: "What is the Microchip recommendation for this?" 

I have looked for such a recommendation. I have not found one. When I started selling these my tinyAVR breakout boards, I had somehow gotten the idea that 4.7k was an official value - my best guess as to where that came from is that I saw it in the documentation for pyudpi, which was (and still is) a very popular tool for programming these parts.. Obviuously, pyupdi is not an official Microchip sanctioned piece of software. Beyond that, the value used for pyupdi is = as far as I can determine - largely dictated by the electrical properties of the serial adapter. Experience has shown that the value needed to make pyupdi work reliably depends largely on serial adapter. The standard value of 4.7k works great for anything for a wide ranger of power voltage configur
